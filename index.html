<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spencer Chat</title>
    <style>
        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #000;
            color: white;
            height: 100vh;
            overflow: hidden;
        }

        /* Welcome Page Styles */
        #welcome-page {
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
        }

        .text-container {
            font-weight: bold;
            font-size: 3rem;
            line-height: 1.5;
            margin-bottom: 2rem;
        }

        .fade-text {
            text-shadow: 3px 3px 7px rgba(0, 0, 0, 0.6);
            background: linear-gradient(to right, #FFA500, #FF4500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
        }

        .fade-text::after {
            content: "|";
            animation: blink 1s infinite;
            color: #FFA500;
        }

        .tap-to-chat {
            display: block;
            margin-top: 15px;
            font-size: 1.8rem;
            font-weight: normal;
            color: #FFA500;
        }

        /* Main App Container (hidden initially) */
        #app-container {
            display: none;
            height: 100%;
            flex-direction: column;
        }

        /* Chat Container */
        #chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        #chat-box {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            background-color: #000;
        }

        .message {
            margin: 15px;
            padding: 12px;
            border-radius: 15px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .user {
            background-color: #1a1a1a;
            margin-left: auto;
            margin-right: 10px;
        }

        .bot {
            background-color: #252525;
            margin-right: auto;
            margin-left: 10px;
            position: relative;
            opacity: 0;
            animation: fadeIn 0.5s ease-in-out forwards;
        }

        .typing {
            display: flex;
            padding: 10px;
            margin: 10px;
            border-radius: 20px;
            background-color: #252525;
            max-width: 80%;
            margin-right: auto;
            margin-left: 10px;
        }

        .typing-dots {
            width: 8px;
            height: 8px;
            margin: 0 2px;
            background: white;
            border-radius: 50%;
            animation: blink 1.4s infinite;
        }

        .typing-dots:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots:nth-child(3) {
            animation-delay: 0.4s;
        }

        /* Input Area */
        #input-container {
            display: flex;
            padding: 10px;
            background: #28282B;
        }

        #user-input {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            background: #1e1e1e;
            color: white;
            outline: none;
        }

        #send-button {
            padding: 15px;
            background: linear-gradient(45deg, #4CAF50, #45A049);
            color: white;
            border: none;
            border-radius: 25px;
            margin-left: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        /* History Page */
        #history-page {
            display: none;
            height: 100%;
            overflow-y: auto;
            padding: 20px;
            background: #121212;
        }

        .history-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .history-card {
            background: #1e1e1e;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            border: 1px solid #333;
        }

        .card-header {
            padding: 1.2rem;
            background: #252525;
            border-bottom: 1px solid #333;
        }

        .card-header h3 {
            font-size: 1.1rem;
            margin-bottom: 0.3rem;
            color: #ffffff;
        }

        .card-header .date {
            font-size: 0.85rem;
            color: #aaa;
        }

        .card-content {
            padding: 1.2rem;
            max-height: 200px;
            overflow-y: auto;
        }

        /* Bottom Navigation */
        .bottom-nav {
            display: flex;
            background: #1e1e1e;
            border-top: 1px solid #333;
        }

        .nav-item {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: background 0.3s;
        }

        .nav-item.active {
            background: #333;
        }

        .nav-item i {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        /* Name Modal */
        #nameModal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 400px;
            background-color: #1e1e1e;
            border-radius: 12px;
            padding: 20px;
            display: none; /* Initially hidden */
            z-index: 1000;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }

        #nameModal .modal-content h2 { /* Added for better structure if needed */
            margin-bottom: 15px;
        }

        #nameInput, #emailInput { /* Applied styles to both */
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            border: 1px solid #555;
            border-radius: 90px; /* This seems like a large radius, kept as is */
            margin-bottom: 15px;
            background-color: #2c2c2c;
            color: white;
            outline: none; /* Added for consistency */
        }

        .button-group {
            display: flex;
            justify-content: space-between;
            gap: 10px; /* Added gap for better spacing */
        }

        #skipButton, #saveButton {
            flex: 1;
            padding: 12px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        #saveButton {
            background-color: #00b894;
            color: white;
        }

        #skipButton {
            background-color: #d63031;
            color: white;
        }

        /* Animations */
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .text-container {
                font-size: 2rem;
            }

            .history-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Disable text selection highlighting */
body {
    -webkit-touch-callout: none; /* iOS Safari */
    -webkit-user-select: none; /* Safari */
    -khtml-user-select: none; /* Konqueror HTML */
    -moz-user-select: none; /* Firefox */
    user-select: none; /* Standard syntax */
}

/* Optional: Allow selection in input fields */
input, textarea {
    -webkit-user-select: text !important;
    user-select: text !important;
}

/* ===== COPY BUTTON STYLES ===== */
.message.bot {
    position: relative;
    padding-right: 40px; /* Make space for button */
}

.copy-btn {
    position: absolute;
    right: 10px;
    top: 10px;
    background: #333;
    color: white;
    border: none;
    border-radius: 4px;
    width: 25px;
    height: 25px;
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.message.bot:hover .copy-btn {
    opacity: 1;
}

.copy-btn i {
    font-size: 12px;
}

/* Mobile always show */
@media (max-width: 768px) {
    .copy-btn {
        opacity: 1 !important;
    }
}

/* ===== SIMPLE MODAL STYLES ===== */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
}

.modal-overlay.active {
    opacity: 1;
    pointer-events: all;
}

.simple-modal {
    background: #252525;
    border-radius: 10px;
    padding: 20px;
    width: 90%;
    max-width: 400px;
    border: 1px solid #444;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
}

.modal-actions {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.modal-btn {
    flex: 1;
    padding: 10px;
    border-radius: 5px;
    border: none;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.2s;
}

.modal-btn.confirm {
    background: #d63031;
    color: white;
}

.modal-btn.cancel {
    background: #333;
    color: white;
}

.modal-btn:hover {
    transform: translateY(-2px);
}


/* Clear History Button Styles */
.action-btn {
    background: linear-gradient(45deg, #d63031, #ff7675);
    color: white;
    border: none;
    border-radius: 25px;
    padding: 10px 20px;
    font-size: 0.9rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s;
    box-shadow: 0 2px 10px rgba(214, 48, 49, 0.3);
}

.action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(214, 48, 49, 0.4);
}

.action-btn:active {
    transform: translateY(0);
}

/* Adjust the actions container */
.actions {
    margin: 20px 0;
    display: flex;
    justify-content: flex-end;
}

@media (max-width: 768px) {
    .action-btn {
        width: 100%;
        justify-content: center;
        padding: 12px;
    }
    
    .actions {
        padding: 0 10px;
    }
}

/* Remove tap highlights on all elements */
* {
    -webkit-tap-highlight-color: transparent;
}

/* Specifically for your Clear History button */
.action-btn {
    -webkit-tap-highlight-color: transparent;
    tap-highlight-color: transparent;
}

/* Remove mobile highlight effects */
.action-btn {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    outline: none;
}

/* History Card Styles */
.history-card {
    background: #1e1e1e;
    border-radius: 12px;
    margin-bottom: 20px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    border: 1px solid #333;
}

.card-header {
    padding: 1rem;
    background: #252525;
    border-bottom: 1px solid #333;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.card-header h3 {
    margin: 0;
    font-size: 1rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 70%;
}

.card-header .date {
    color: #aaa;
    font-size: 0.8rem;
}

.card-content {
    padding: 0.5rem;
    max-height: 300px;
    overflow-y: auto;
}

.conversation-item {
    margin-bottom: 1rem;
    padding: 0.5rem;
    border-bottom: 1px solid #2a2a2a;
}

.conversation-item:last-child {
    border-bottom: none;
}

.time-stamp {
    color: #FFA500;
    font-size: 0.7rem;
    margin-bottom: 0.3rem;
}

/* Make messages more compact in history view */
.card-content .message {
    margin: 0.3rem 0;
    padding: 0.5rem;
    max-width: 100%;
    font-size: 0.9rem;
}

.card-content .user {
    margin-left: 0;
}

.card-content .bot {
    margin-right: 0;
}

.history-card:not(.expanded) .card-content {
    display: none;
}

.history-card.expanded .card-content {
    display: block;
}

/* History Card Dropdown Styles */
.card-header {
    position: relative;
    cursor: pointer;
    transition: background 0.2s;
}

.card-header:hover {
    background: #2e2e2e;
}

.toggle-icon {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    transition: transform 0.2s;
    font-size: 0.9rem;
    color: #aaa;
}

.history-card.expanded .toggle-icon {
    transform: translateY(-50%) rotate(180deg);
}

.continue-chat-btn {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
    background: linear-gradient(45deg, #4CAF50, #45A049);
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.2s;
}

.continue-chat-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 2px 10px rgba(76, 175, 80, 0.3);
}

.continue-chat-btn:active {
    transform: translateY(0);
}

/* Animation for dropdown */
.card-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
    padding: 0 1.2rem;
}

.history-card.expanded .card-content {
    max-height: 500px;
    padding: 1.2rem;
}
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
    <div id="welcome-page">
        <div class="text-container">
            <div id="animatedText" class="fade-text"></div>
            
        </div>
    </div>

    <!-- Add this button anywhere in your app-container -->
<button id="reset-user" style="position: fixed; bottom: 70px; right: 10px; z-index: 1000; padding: 8px 12px; background: #ff4444; color: white; border: none; border-radius: 5px; cursor: pointer;">
    Reset User
</button>

    <div id="app-container">
        <div id="chat-container">
            <div id="chat-box"></div>
            <div id="input-container">
                <input type="text" id="user-input" placeholder="Message...">
                <button id="send-button">Send</button>
            </div>
        </div>

        <div id="history-page">
            
            <div class="actions">
                <button id="clear-history" class="action-btn">
    <i class="fas fa-trash-alt"></i> Clear History
</button>
            </div>
            <div id="history-container"></div>
            <div id="empty-state" class="empty-state" style="display: none;">
                
                <h2>No Chat History</h2>
                <p>Your conversation history will appear here</p>
            </div>
        </div>

        <div class="bottom-nav">
            <div class="nav-item active" id="nav-chat">
                <i class="fas fa-comment-alt"></i>
                <div>Chat</div>
            </div>
            <div class="nav-item" id="nav-history">
                <i class="fas fa-history"></i>
                <div>History</div>
            </div>
        </div>
    </div>

    <div id="nameModal">
        <div class="modal-content">
            <h2>Hi, I'm Spencer.<br>What's your name & email?</h2>
            <input type="text" id="nameInput" placeholder="Enter your name here">
            <input type="email" id="emailInput" placeholder="Enter your email here">
            <div class="button-group">

                <button id="saveButton">Save</button>
            </div>
        </div>
    </div>

    <script>

    // Add this to your existing JavaScript
document.getElementById('reset-user').addEventListener('click', function() {
    // Clear user data from localStorage
    localStorage.removeItem(CONFIG.userNameKey);
    localStorage.removeItem(CONFIG.userEmailKey);

    // Show welcome page again
    appContainer.style.display = 'none';
    welcomePage.style.display = 'flex';

    // Reset the animated text
    displayWelcomeMessage();

    alert("User data cleared. Welcome page will show again.");
});

        // Configuration
        const CONFIG = {
            chatHistoryKey: "spencer_chat_history",
            userNameKey: "spencer_user_name",
            userEmailKey: "spencer_user_email", // <-- ADDED EMAIL KEY

        };

        // DOM Elements
        const welcomePage = document.getElementById('welcome-page');
        const appContainer = document.getElementById('app-container');
        const chatContainer = document.getElementById('chat-container');
        const historyPage = document.getElementById('history-page');
        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const navChat = document.getElementById('nav-chat');
        const navHistory = document.getElementById('nav-history');
        const historyContainer = document.getElementById('history-container');
        const emptyState = document.getElementById('empty-state');
        const clearHistoryBtn = document.getElementById('clear-history');
        const nameModal = document.getElementById('nameModal');
        const nameInput = document.getElementById('nameInput');
        const emailInput = document.getElementById('emailInput'); // <-- ADDED EMAIL INPUT ELEMENT
        const saveButton = document.getElementById('saveButton');
        const animatedText = document.getElementById('animatedText');

        // State
        let currentPage = 'chat';

        // Initialize the app
        function initApp() {
            const savedUsername = localStorage.getItem(CONFIG.userNameKey);

            // const savedEmail = localStorage.getItem(CONFIG.userEmailKey); // We might use this later if needed

            if (!savedUsername) {
    showNameModal();
}
             else {
                displayWelcomeMessage(savedUsername);
            }
            setupEventListeners();
        }

        function setupEventListeners() {
            welcomePage.addEventListener('click', startChatApp);
            userInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
            sendButton.addEventListener('click', sendMessage);
            navChat.addEventListener('click', () => switchPage('chat'));
            navHistory.addEventListener('click', () => switchPage('history'));
            clearHistoryBtn.addEventListener('click', function(e) {
    e.preventDefault(); // Prevent default behavior
    clearHistory(); // Just shows the modal
});

            saveButton.addEventListener('click', saveNameAndEmail); // Renamed for clarity
            
        clearHistoryBtn.addEventListener('click', clearHistory);
        
         // Add modal close when clicking outside
    document.getElementById('confirmModal').addEventListener('click', (e) => {
        if (e.target === document.getElementById('confirmModal')) {
            document.getElementById('confirmModal').classList.remove('active');
        }
    });
    
    
// Add these new event listeners at the end of your setupEventListeners function:
document.getElementById('confirmClear').addEventListener('click', () => {
    localStorage.removeItem(CONFIG.chatHistoryKey);
    loadHistoryView();
    if (currentPage === 'chat') {
        chatBox.innerHTML = '';
    }
    document.getElementById('confirmModal').classList.remove('active');
});

document.getElementById('cancelClear').addEventListener('click', () => {
    document.getElementById('confirmModal').classList.remove('active');
});

document.getElementById('confirmClear').addEventListener('click', () => {
    // ACTUAL clearing happens here only after confirmation
    localStorage.removeItem(CONFIG.chatHistoryKey);
    loadHistoryView();
    chatBox.innerHTML = ''; // Clear chat view too
    document.getElementById('confirmModal').classList.remove('active');
});

        }
        
        
        
            
        

        function showNameModal() {
            nameModal.style.display = 'block';
        }

        function hideNameModal() {
            nameModal.style.display = 'none';
        }


        // Basic email validation (you might want a more robust one)
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

       async function saveNameAndEmail() {
    const name = nameInput.value.trim();
    const email = emailInput.value.trim();

    if (!name) {
        alert('Please enter a valid name!');
        return;
    }
    if (!email) {
        alert('Please enter your email!');
        return;
    }
    if (!isValidEmail(email)) {
        alert('Please enter a valid email address!');
        return;
    }

    // Show loading state
    saveButton.disabled = true;
    saveButton.textContent = 'Sending...';

    try {
        const submissionSuccess = await submitUserInfo(name, email);

        if (submissionSuccess) {
            localStorage.setItem(CONFIG.userNameKey, name);
            localStorage.setItem(CONFIG.userEmailKey, email);
            hideNameModal();
            displayWelcomeMessage(name);
        } else {
            alert('Failed to submit your information. Please try again.');
        }
    } catch (error) {
        console.error('Error in saveNameAndEmail:', error);
        alert('An unexpected error occurred. Please try again.');
    } finally {
        // Reset button state
        saveButton.disabled = false;
        saveButton.textContent = 'Save';
    }
}

        // NEW FUNCTION TO "SUBMIT" USER INFO

        async function submitUserInfo(name, email) {
    const formSubmitURL = 'https://formsubmit.co/ukowills@gmail.com';

    const data = {
        name: name,
        email: email,
        _subject: "New User Sign-up from Spencer Chat",
        _template: "table",
        timestamp: new Date().toISOString()
    };

    try {
        const response = await fetch(formSubmitURL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify(data),
        });

        // Get the response text (formsubmit.co returns HTML)
        const responseText = await response.text();
        console.log('Form submission response:', responseText);

        if (response.ok) {
            console.log('Successfully submitted to formsubmit.co');
            return true; // Indicate success
        } else {
            console.error('Submission failed with status:', response.status);
            return false; // Indicate failure
        }
    } catch (error) {
        console.error('Error submitting to formsubmit.co:', error);
        return false; // Indicate failure
    }
}


        function displayWelcomeMessage(name = null) {
            const timeGreeting = getTimeGreeting();
            let greetingText;

            if (name) {
                greetingText = `${timeGreeting}, ${name}. Tap to chat`;
            } else {
                greetingText = `${timeGreeting}. I'm Spencer. Tap to chat`;
            }
            animateText(greetingText);
        }

        function animateText(text) {
            animatedText.textContent = "";
            let index = 0;
            function typeWriter() {
                if (index < text.length) {
                    animatedText.textContent += text.charAt(index);
                    index++;
                    setTimeout(typeWriter, 50);
                }
            }
            typeWriter();
        }

        function getTimeGreeting() {
            const hour = new Date().getHours();
            if (hour < 12) return "Good morning";
            if (hour < 18) return "Good afternoon";
            return "Good evening";
        }

        function startChatApp() {
            welcomePage.style.display = 'none';
            appContainer.style.display = 'flex';
            loadChatHistory();
        }

        function switchPage(page) {
            currentPage = page;
            if (page === 'chat') {
                chatContainer.style.display = 'flex';
                historyPage.style.display = 'none';
                navChat.classList.add('active');
                navHistory.classList.remove('active');
            } else {
                chatContainer.style.display = 'none';
                historyPage.style.display = 'block';
                navChat.classList.remove('active');
                navHistory.classList.add('active');
                loadHistoryView();
            }
        }

        function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;
            addMessage(message, 'user');
            userInput.value = '';

            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'typing';
            typingIndicator.innerHTML = `
                <span class="typing-dots"></span>
                <span class="typing-dots"></span>
                <span class="typing-dots"></span>
            `;
            chatBox.appendChild(typingIndicator);
            chatBox.scrollTop = chatBox.scrollTop + 100; // Consider chatBox.scrollHeight

            setTimeout(() => {
                if (typingIndicator.parentNode) {
                    chatBox.removeChild(typingIndicator);
                }
                const response = generateResponse(message);
                addMessage(response, 'bot');
                saveToHistory(message, response);
            }, 1500);
        }

        function addMessage(text, sender) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender}`;
    
    if (sender === 'bot') {
        messageDiv.innerHTML = `
            ${text}
            <button class="copy-btn" title="Copy to clipboard">
                <i class="fas fa-copy"></i>
            </button>
        `;
        
        // Add copy functionality
        const copyBtn = messageDiv.querySelector('.copy-btn');
        copyBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(text).then(() => {
                // Visual feedback
                copyBtn.innerHTML = '<i class="fas fa-check"></i>';
                copyBtn.style.background = '#4CAF50';
                setTimeout(() => {
                    copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
                    copyBtn.style.background = '#333';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
                copyBtn.innerHTML = '<i class="fas fa-times"></i>';
                copyBtn.style.background = '#f44336';
                setTimeout(() => {
                    copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
                    copyBtn.style.background = '#333';
                }, 2000);
            });
        });
    } else {
        messageDiv.textContent = text;
    }
    
    chatBox.appendChild(messageDiv);
    chatBox.scrollTop = chatBox.scrollHeight;
}

       function generateResponse(input) {
    const responses = [
        // Friendly greetings
        "Hi there! I'm Spencer, your AI assistant. Currently offline, but I'd love to help more when we connect online.",
        "Hello! For my best assistance, I'll need to sync with you online first.",
        "Greetings! I'm just getting to know you - chatting online will help me learn how to assist you better.",

        // Clear offline status explanations
        "I'm currently offline, so my responses are limited. Connecting online will give me full functionality.",
        "Offline mode active: My capabilities are restricted until we establish an online connection.",
        "Notice: Operating in offline mode. Full features unlock when we chat online.",

        // Encouraging online connection
        "Let's chat online for 5-10 minutes first - that helps me understand how best to assist you offline!",
        "For personalized assistance, please connect online so I can learn your preferences.",
        "I become much more helpful after we've chatted online for a bit - would you like to connect?",

        // Setting expectations
        "While offline, I can offer basic responses. For in-depth help, we'll need an online session.",
        "Think of this as our first meeting - I'll be much more useful after we sync online.",
        "I'm like a new notebook right now - chatting online will help me fill pages with how to help you.",

        // Playful analogies
        "I'm currently running on starter batteries - an online chat will switch me to full power!",
        "Offline me is like a car in neutral - let's go online to put me in gear!",
        "Right now I'm like a phone with spotty service - much clearer when we connect properly!",

        // Transition suggestions
        "Shall we continue this conversation online where I can be more helpful?",
        "I'd love to pick this up when we're online - that's when I really shine!",
        "This is interesting! Let's switch to online chat so I can give you better responses.",

        // Value propositions
        "Online chats help me build a memory of your preferences for better future assistance.",
        "Every online conversation makes me smarter about how to help you specifically.",
        "The more we chat online, the more tailored my responses become to your needs.",

        // Reassurance
        "Don't worry - even brief online chats significantly improve my ability to assist you.",
        "Just 5-10 minutes online will give me enough data to be much more useful.",
        "I'm designed to learn quickly - a short online session will dramatically improve my responses.",

        // Final fallbacks
        "I'm Spencer at your service! Currently offline but ready to connect for better assistance.",
        "Hello! Let's establish an online connection first for optimal results."
    ];

    // Optional: Add some basic input recognition
    const lowerInput = input.toLowerCase();
    if (lowerInput.includes('hello') || lowerInput.includes('hi')) {
        return responses[0]; // Return a greeting response
    }
    if (lowerInput.includes('offline') || lowerInput.includes('connect')) {
        return responses[3]; // Return an offline explanation
    }

    // Default random response
    return responses[Math.floor(Math.random() * responses.length)];
}

        function saveToHistory(userMessage, botResponse) {
    let history = JSON.parse(localStorage.getItem(CONFIG.chatHistoryKey)) || [];
    
    // Create a better title from the first message
    const title = userMessage.length > 30 
        ? userMessage.substring(0, 30) + '...'
        : userMessage;
    
    const newEntry = {
        user: userMessage,
        bot: botResponse,
        timestamp: new Date().toISOString(),
        title: title // Store the title separately
    };
    
    history.push(newEntry);
    localStorage.setItem(CONFIG.chatHistoryKey, JSON.stringify(history));
}
        function loadChatHistory() {
            const history = JSON.parse(localStorage.getItem(CONFIG.chatHistoryKey)) || [];
            if (history.length > 0) {
                // Optionally, load more than just the last entry, or all of the current session.
                // For now, sticking to the original behavior of loading the very last exchange.
                const lastEntry = history[history.length - 1];
                addMessage(lastEntry.user, 'user');
                addMessage(lastEntry.bot, 'bot');
            }
        }

        function loadHistoryView() {
    const history = JSON.parse(localStorage.getItem(CONFIG.chatHistoryKey)) || [];
    historyContainer.innerHTML = '';
    
    if (history.length === 0) {
        emptyState.style.display = 'block';
        return;
    }
    
    emptyState.style.display = 'none';
    
    // Group conversations by date
    const groupedByDate = history.reduce((groups, entry) => {
        const date = new Date(entry.timestamp).toDateString();
        if (!groups[date]) {
            groups[date] = [];
        }
        groups[date].push(entry);
        return groups;
    }, {});
    
    // Sort dates in descending order (newest first)
    const sortedDates = Object.keys(groupedByDate).sort((a, b) => {
        return new Date(b) - new Date(a);
    });
    
    // Create one card per date
    sortedDates.forEach(date => {
        const conversations = groupedByDate[date];
        const card = document.createElement('div');
        card.className = 'history-card';
        
        // Use first user message as title
        const firstConversation = conversations[0];
        const conversationTitle = firstConversation.user.length > 30 
            ? firstConversation.user.substring(0, 30) + '...' 
            : firstConversation.user;
        
        // Format date nicely
        const formattedDate = new Date(date).toLocaleDateString('en-US', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
        
        // Create safe ID for content div
        const contentId = 'content-' + date.replace(/\s+/g, '-');
        
        // Create card HTML with continue button
        card.innerHTML = `
            <div class="card-header">
                <h3>${conversationTitle}</h3>
                <div class="date">${formattedDate}</div>
                <i class="fas fa-chevron-down toggle-icon"></i>
            </div>
            <div class="card-content" id="${contentId}">
                <!-- Messages will be inserted here -->
                <button class="continue-chat-btn">
                    <i class="fas fa-comment"></i> Continue this chat
                </button>
            </div>
        `;
        
        // Add all conversations for this date
        const contentDiv = card.querySelector(`#${contentId}`);
        const continueBtn = contentDiv.querySelector('.continue-chat-btn');
        
        // Add click handler for continue button
        continueBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            switchPage('chat');
            chatBox.innerHTML = '';
            groupedByDate[date].forEach(convo => {
                addMessage(convo.user, 'user');
                addMessage(convo.bot, 'bot');
            });
        });
        
        conversations.forEach(conversation => {
            const time = new Date(conversation.timestamp).toLocaleTimeString([], {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            const conversationDiv = document.createElement('div');
            conversationDiv.className = 'conversation-item';
            conversationDiv.innerHTML = `
                <div class="time-stamp">${time}</div>
                <div class="message user">${conversation.user}</div>
                <div class="message bot">
                    ${conversation.bot}
                    <button class="copy-btn" title="Copy to clipboard">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
            `;
            
            // Add copy functionality
            conversationDiv.querySelector('.copy-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                navigator.clipboard.writeText(conversation.bot).then(() => {
                    const btn = e.target.closest('.copy-btn');
                    btn.innerHTML = '<i class="fas fa-check"></i>';
                    btn.style.background = '#4CAF50';
                    setTimeout(() => {
                        btn.innerHTML = '<i class="fas fa-copy"></i>';
                        btn.style.background = '#333';
                    }, 2000);
                });
            });
            
            contentDiv.insertBefore(conversationDiv, continueBtn);
        });
        
        // Toggle dropdown when clicking header
        const cardHeader = card.querySelector('.card-header');
        const toggleIcon = cardHeader.querySelector('.toggle-icon');
        
        cardHeader.addEventListener('click', (e) => {
            if (!e.target.classList.contains('copy-btn')) {
                card.classList.toggle('expanded');
                toggleIcon.classList.toggle('fa-chevron-down');
                toggleIcon.classList.toggle('fa-chevron-up');
            }
        });
        
        historyContainer.appendChild(card);
    });
}
        function clearHistory() {
             // Show our custom modal instead of default confirm
    document.getElementById('confirmModal').classList.add('active');{
                
    // Just show the modal - no clearing happens here
    document.getElementById('confirmModal').classList.add('active');
    return false; // Prevent default behavior
}
        }

        document.addEventListener('DOMContentLoaded', initApp);
    </script>
    
    <!-- Simple Modal -->
<div class="modal-overlay" id="confirmModal">
    <div class="simple-modal">
        <h3>Clear All History?</h3>
        <p>This will permanently delete all your chat history.</p>
        <div class="modal-actions">
            <button class="modal-btn cancel" id="cancelClear">Cancel</button>
            <button class="modal-btn confirm" id="confirmClear">Clear</button>
        </div>
    </div>
</div>
</body>
</html>
